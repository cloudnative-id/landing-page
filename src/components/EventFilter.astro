---
interface Props {
  sectionId: string;
  showTimeFilter?: boolean;
}

const { sectionId, showTimeFilter = false } = Astro.props;
---

<div class="mb-8 bg-white rounded-xl shadow-md p-6">
  <div class="flex flex-col lg:flex-row gap-4">
    <!-- Search Bar -->
    <div class="flex-1">
      <div class="relative">
        <input
          type="text"
          id={`search-${sectionId}`}
          placeholder="Search events by title, topic, or location..."
          class="w-full px-4 py-3 pl-12 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition"
        />
        <svg class="w-5 h-5 text-gray-400 absolute left-4 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>
    </div>

    <!-- Filter by Time (Upcoming/Past) -->
    {showTimeFilter && (
      <div class="lg:w-48">
        <select
          id={`filter-time-${sectionId}`}
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition appearance-none bg-white cursor-pointer font-medium"
        >
          <option value="all">All Events</option>
          <option value="upcoming">Upcoming</option>
          <option value="past">Past Events</option>
        </select>
      </div>
    )}

    <!-- Filter by Type -->
    <div class="lg:w-48">
      <select
        id={`filter-type-${sectionId}`}
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition appearance-none bg-white cursor-pointer"
      >
        <option value="all">All Types</option>
        <option value="meetup">Meetup</option>
        <option value="workshop">Workshop</option>
        <option value="conference">Conference</option>
        <option value="webinar">Webinar</option>
      </select>
    </div>

    <!-- Filter by Location -->
    <div class="lg:w-48">
      <select
        id={`filter-location-${sectionId}`}
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none transition appearance-none bg-white cursor-pointer"
      >
        <option value="all">All Locations</option>
        <option value="jakarta">Jakarta</option>
        <option value="bandung">Bandung</option>
        <option value="yogyakarta">Yogyakarta</option>
        <option value="online">Online</option>
      </select>
    </div>

    <!-- Clear Filters -->
    <button
      id={`clear-filters-${sectionId}`}
      class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-medium whitespace-nowrap"
    >
      Clear All
    </button>
  </div>

  <!-- Results Count -->
  <div class="mt-4 text-sm text-gray-600">
    Showing <span id={`results-count-${sectionId}`} class="font-semibold text-blue-600">0</span> event(s)
  </div>
</div>

<script define:vars={{ sectionId, showTimeFilter }}>
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById(`search-${sectionId}`);
    const filterType = document.getElementById(`filter-type-${sectionId}`);
    const filterLocation = document.getElementById(`filter-location-${sectionId}`);
    const filterTime = showTimeFilter ? document.getElementById(`filter-time-${sectionId}`) : null;
    const clearBtn = document.getElementById(`clear-filters-${sectionId}`);
    const resultsCount = document.getElementById(`results-count-${sectionId}`);
    const eventsGrid = document.getElementById(`events-grid-${sectionId}`);
    const noResults = document.getElementById(`no-results-${sectionId}`);

    function filterEvents() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedType = filterType.value;
      const selectedLocation = filterLocation.value;
      const selectedTime = filterTime ? filterTime.value : 'all';

      const eventCards = eventsGrid.querySelectorAll('.event-card');
      let visibleCount = 0;

      eventCards.forEach(card => {
        const title = card.dataset.title.toLowerCase();
        const topic = card.dataset.topic.toLowerCase();
        const location = card.dataset.location.toLowerCase();
        const type = card.dataset.type.toLowerCase();
        const timeStatus = card.dataset.timeStatus || 'upcoming';

        const matchesSearch = title.includes(searchTerm) || 
                            topic.includes(searchTerm) || 
                            location.includes(searchTerm);
        const matchesType = selectedType === 'all' || type === selectedType;
        const matchesLocation = selectedLocation === 'all' || location.includes(selectedLocation.toLowerCase());
        const matchesTime = selectedTime === 'all' || timeStatus === selectedTime;

        if (matchesSearch && matchesType && matchesLocation && matchesTime) {
          card.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });

      resultsCount.textContent = visibleCount;
      
      // Show/hide no results message
      if (visibleCount === 0) {
        noResults.style.display = 'block';
        eventsGrid.style.display = 'none';
      } else {
        noResults.style.display = 'none';
        eventsGrid.style.display = 'grid';
      }
    }

    function clearFilters() {
      searchInput.value = '';
      filterType.value = 'all';
      filterLocation.value = 'all';
      if (filterTime) filterTime.value = 'all';
      filterEvents();
    }

    searchInput.addEventListener('input', filterEvents);
    filterType.addEventListener('change', filterEvents);
    filterLocation.addEventListener('change', filterEvents);
    if (filterTime) filterTime.addEventListener('change', filterEvents);
    clearBtn.addEventListener('click', clearFilters);

    // Initial count
    filterEvents();
  });
</script>
